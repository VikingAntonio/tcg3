<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Álbumes - TCG Dual</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/barajaryg.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="js/turn.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Three.js for 3D Loading Screen -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
      }
    </script>
    <script type="module" src="js/loading3d.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
</head>
<body class="public-body">
    <!-- Floating User Panel -->
    <div class="top-right-panel" id="top-panel">
        <div class="theme-switcher-small">
            <button class="theme-btn-small" data-theme="theme-light" title="Modo Claro"><i class="fas fa-sun"></i></button>
            <button class="theme-btn-small" data-theme="theme-medium" title="Modo Medio"><i class="fas fa-palette"></i></button>
            <button class="theme-btn-small" data-theme="theme-dark" title="Modo Oscuro"><i class="fas fa-moon"></i></button>
        </div>
        <div class="user-menu-container">
            <button class="user-avatar-btn" id="avatar-btn">
                <i class="fas fa-user"></i>
            </button>
            <div class="user-dropdown-menu" id="user-dropdown">
                <div class="user-dropdown-info">
                    <div class="user-dropdown-name" id="dropdown-user-name">Invitado</div>
                    <div class="user-dropdown-role" id="dropdown-user-role">Invitado</div>
                </div>
                <a href="admin.html" class="menu-item"><i class="fas fa-lock"></i> Panel Admin</a>
                <a href="#" class="menu-item" id="menu-spirit-btn"><i class="fas fa-ghost"></i> Ver Compañeros</a>
            </div>
        </div>
    </div>
    <!-- Pantalla de Carga -->
    <div id="loading-screen" class="loading-screen">
        <div id="loading-3d-container"></div>
        <div class="loading-message">Cargando interfaz...</div>
    </div>

    <header class="public-header">
        <div class="store-badge">
            <i class="fas fa-store"></i>
            <span id="public-store-name">Cargando Tienda...</span>
        </div>
        <h1 id="public-view-title">Colección de Álbumes</h1>
        <p>Explora nuestra selección de cartas y colecciones exclusivas.</p>

        <nav class="public-nav">
            <button class="nav-btn active" data-view="albums"><i class="fas fa-book"></i> Álbumes</button>
            <button class="nav-btn" data-view="decks"><i class="fas fa-layer-group"></i> Decks</button>
            <button class="nav-btn" id="spirit-btn"><i class="fas fa-ghost"></i> Compañeros</button>
        </nav>


        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Buscar álbumes o cartas...">
                <button id="clear-search" style="display:none;"><i class="fas fa-times"></i></button>
            </div>
        </div>
    </header>

    <div class="public-main-container" id="main-view-container">
        <div id="no-results" class="empty" style="display:none; margin-top: 50px;">
            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
            <p>No se encontraron resultados para tu búsqueda.</p>
        </div>

        <div id="albums-view" class="view-section active">
            <div id="albums-container">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Cargando álbumes...
                </div>
            </div>
        </div>

        <div id="decks-view" class="view-section">
            <div id="decks-container" class="decks-grid">
                <!-- Decks will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Image Overlay / Modal -->
    <!-- Spirit Selection Modal -->
    <div id="spirit-modal" class="overlay">
        <div class="overlay-content spirit-selection-content" style="max-width: 1100px; width: 95%;">
            <span id="close-spirit-modal" class="close-btn">&times;</span>
            <h2 style="color: #00d2ff; text-align: center; margin-bottom: 20px;">Compañeros 3D</h2>

            <div id="public-spirits-grid" class="spirits-grid">
                <!-- Spirits will be loaded here -->
            </div>
        </div>
    </div>

    <div id="gltf-overlay" class="overlay">
        <span id="close-gltf-overlay" class="close-btn-floating">&times;</span>
        <div class="overlay-content gltf-expanded-content">
            <model-viewer id="expanded-gltf-viewer"
                loading="lazy"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                environment-image="neutral"
                exposure="1.2">
            </model-viewer>
            <div class="card-info">
                <div id="expanded-gltf-name" class="card-name">Nombre del Compañero</div>
            </div>
        </div>
    </div>

    <div id="image-overlay" class="overlay">
        <div class="overlay-content">
            <span id="close-btn">&times;</span>
            <div id="card-3d-container" class="card-3d-container">
                <div id="card-3d" class="card-3d">
                    <div id="z-text-container">
                        <img id="expanded-image" src="" alt="Carta Expandida">
                    </div>
                    <div class="holo-layer"></div>
                </div>
            </div>
            <div class="card-info">
                <div id="card-name" class="card-name">Nombre de la Carta</div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Rareza</div>
                        <div id="card-rarity" class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Expansión</div>
                        <div id="card-expansion" class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Estado</div>
                        <div id="card-condition" class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Cantidad</div>
                        <div id="card-quantity" class="info-value">1</div>
                    </div>
                    <div class="info-item price-item">
                        <div class="info-label">Precio Estimado</div>
                        <div id="card-price" class="info-value">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/ztext.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
